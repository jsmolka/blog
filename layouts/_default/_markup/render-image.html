{{ $cap := .Title | $.Page.RenderString }}
{{ $alt := .Text | default $cap | plainify }}
{{ $img := .Page.Resources.GetMatch .Destination }}
{{ if not $img }}
  {{ errorf "file not found %s" .Destination }}
{{ end }}
<figure>
  {{ if hugo.IsProduction }}
    {{ $img = $img | fingerprint "md5" }}
  {{ end }}
  <img src="{{ $img.RelPermalink }}" alt="{{ $alt }}" width="{{ $img.Width }}" height="{{ $img.Height }}" loading="lazy">
  {{ with $cap }}
    <figcaption>{{ . }}</figcaption>
  {{ end }}
</figure>
