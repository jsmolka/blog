{{ $caption := .Get "caption" | $.Page.RenderString }}
{{ $src := .Get "src" }}
{{ $audio := .Page.Resources.GetMatch $src }}
{{ if not $audio }}
  {{ errorf "file not found %s" $src }}
{{ end }}
{{ if hugo.IsProduction }}
  {{ $audio = $audio | fingerprint "md5" }}
{{ end }}
<figure>
  <div data-audio data-src="{{ $audio.RelPermalink }}"></div>
  <noscript>
    <audio src="{{ $audio.RelPermalink }}" type="audio/mp3" preload="metadata" controls></audio>
  </noscript>
  {{ with $caption }}
    <figcaption>{{ . }}</figcaption>
  {{ end }}
</figure>
