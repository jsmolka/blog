{{ $opts := dict "target" "es2015" "minify" hugo.IsProduction }}

{{ with resources.Get "js/theme.js" }}
  {{ $script := . | js.Build $opts }}
  <script type="text/javascript">{{ $script.Content | safeJS }}</script>
{{ end }}

{{ $scripts := slice "main.js" }}
{{ if not hugo.IsProduction }}
  {{ $scripts = $scripts | append "prism.js" }}
{{ end }}
{{ range $scripts }}
  {{ $script := resources.Get (path.Join "js" .) | js.Build (merge $opts (dict "targetPath" .)) }}
  {{ if hugo.IsProduction }}
    {{ $script = $script | fingerprint "md5" }}
  {{ end }}
  <script type="text/javascript" src="{{ $script.RelPermalink }}" defer></script>
{{ end }}

{{ $path := "index.js" }}
{{ if .Params.URL }}
  {{ $base := path.Dir .Params.URL }}
  {{ $name := path.BaseName .Params.URL }}
  {{ $path  = path.Join $base (add $name (path.Ext $path)) }}
{{ end }}
{{ with .Resources.GetMatch "index.js" }}
  {{ $script := . | js.Build (merge $opts (dict "targetPath" $path)) }}
  {{ if hugo.IsProduction }}
    {{ $script = $script | fingerprint "md5" }}
  {{ end }}
  <script type="text/javascript" src="{{ $script.RelPermalink }}" defer></script>
{{ end }}
