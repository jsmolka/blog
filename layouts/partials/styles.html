{{ $opts := dict "config" "assets/scss/postcss.config.js" }}

{{ with resources.Get "scss/main.scss" }}
  {{ $vars := dict }}
  {{ range slice "inter" "inter-italic" "jetbrains-mono" "jetbrains-mono-italic" }}
    {{ $font := resources.Get (path.Join "fonts" (add . ".woff2")) }}
    {{ $vars = $vars | merge (dict . (printf "%s?v=%s" $font.RelPermalink ($font.Content | md5))) }}
  {{ end }}
  {{ $style := . | resources.ToCSS (dict "targetPath" "main.css" "vars" $vars) }}
  {{ if hugo.IsProduction }}
    {{ $style = $style | postCSS $opts | minify | fingerprint "md5" }}
  {{ end }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}">
{{ end }}

{{ with .Resources.GetMatch "index.scss" }}
  {{ $style := . | resources.ToCSS "index.css" }}
  {{ if hugo.IsProduction }}
    {{ $style = $style | postCSS $opts | minify | fingerprint "md5" }}
  {{ end }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}">
{{ end }}
